(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{550:(e,t,s)=>{"use strict";s.d(t,{db:()=>i,j:()=>c});var a=s(2078),l=s(9708),d=s(2553);let r=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyC5SUu7e-aNUfgBEeEoXEwjONknWKhbtBI",authDomain:"rmcheck-4e79c.firebaseapp.com",projectId:"rmcheck-4e79c",storageBucket:"rmcheck-4e79c.firebasestorage.app",messagingSenderId:"1081522017302",appId:"1:1081522017302:web:b7bd3e0436a05c92c29137"}),i=(0,l.aU)(r),c=(0,d.xI)(r)},3136:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155);function l(){return(0,a.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-[var(--primary)] rounded-full animate-spin"})})}},3871:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(5155),l=s(2115),d=s(9708),r=s(550),i=s(9730),c=s(3136);function n(){let{user:e,loading:t}=(0,i.A)(),s=(null==e?void 0:e.role)==="superadmin",[n,o]=(0,l.useState)([]),[m,u]=(0,l.useState)([]),[h,x]=(0,l.useState)([]),[p,f]=(0,l.useState)([]),[j,b]=(0,l.useState)([]),[g,v]=(0,l.useState)(!0),[N,y]=(0,l.useState)(""),[w,I]=(0,l.useState)("");(0,l.useEffect)(()=>{if(e)if(s){let e=(0,d.aQ)((0,d.rJ)(r.db,"academies"),e=>{o(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()}else e.academyId&&y(e.academyId)},[e,s]),(0,l.useEffect)(()=>{if(!N){u([]),I("");return}let e=(0,d.P)((0,d.rJ)(r.db,"classes"),(0,d._M)("academyId","==",N),(0,d._M)("isDeleted","==",!1)),t=(0,d.aQ)(e,e=>u(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>t()},[N]),(0,l.useEffect)(()=>{if(!w){x([]),f([]),b([]),v(!1);return}v(!0);let e=(0,d.P)((0,d.rJ)(r.db,"students"),(0,d._M)("classId","==",w),(0,d._M)("isDeleted","==",!1),(0,d._M)("status","==","active")),t=(0,d.P)((0,d.rJ)(r.db,"academyAssignments"),(0,d._M)("classId","==",w)),s=(0,d.P)((0,d.rJ)(r.db,"submissions"),(0,d._M)("classId","==",w)),a=(0,d.aQ)(e,e=>x(e.docs.map(e=>({id:e.id,...e.data()})))),l=(0,d.aQ)(t,e=>f(e.docs.map(e=>({id:e.id,...e.data()})))),i=(0,d.aQ)(s,e=>b(e.docs.map(e=>({id:e.id,...e.data()}))));return v(!1),()=>{a(),l(),i()}},[w]);let _=(0,l.useMemo)(()=>{let e=new Map;return j.forEach(t=>{t.userId&&t.assignmentId&&e.set("".concat(t.userId,"_").concat(t.assignmentId),t)}),e},[j]);return t?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(c.A,{})}):(0,a.jsxs)("div",{className:"p-8 h-full overflow-y-auto bg-slate-50",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:"과제 현황"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:"수업별 학생들의 과제 제출 현황을 확인합니다."})]}),(0,a.jsxs)("div",{className:"flex gap-4 mb-6 bg-white p-4 rounded-lg shadow-sm border border-slate-200",children:[s&&(0,a.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"form-select",children:[(0,a.jsx)("option",{value:"",children:"학원 선택"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)("select",{value:w,onChange:e=>I(e.target.value),className:"form-select",disabled:!N,children:[(0,a.jsx)("option",{value:"",children:"수업 선택"}),m.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),g?(0,a.jsx)(c.A,{}):w?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header text-left sticky left-0 bg-slate-50 z-10 px-4 py-3",children:"학생 이름"}),p.sort((e,t)=>e.dueDate.toMillis()-t.dueDate.toMillis()).map(e=>(0,a.jsx)("th",{className:"table-header text-left px-4 py-3",title:e.title,children:e.dayTitle||e.title},e.id))]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:h.length>0?h.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-medium text-slate-800 sticky left-0 bg-white z-10",children:e.studentName}),p.map(t=>{let s=_.has("".concat(e.id,"_").concat(t.id));return(0,a.jsx)("td",{className:"px-4 py-3 text-left",children:s?(0,a.jsx)("span",{className:"text-green-600 font-bold text-lg",children:"✅"}):(0,a.jsx)("span",{className:"text-red-500 text-lg",children:"❌"})},t.id)})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:p.length+1,className:"py-16 text-center text-slate-500",children:"선택된 수업에 등록된 학생이 없습니다."})})})]})}),0===p.length&&h.length>0&&(0,a.jsx)("div",{className:"py-16 text-center text-slate-500",children:"아직 생성된 과제가 없습니다."})]}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-16 text-center text-slate-500",children:s?(0,a.jsx)("p",{className:"text-lg",children:"현황을 보려면 학원과 수업을 선택해주세요."}):(0,a.jsx)("p",{className:"text-lg",children:"현황을 보려면 수업을 선택해주세요."})})]})}},7202:(e,t,s)=>{Promise.resolve().then(s.bind(s,3871))},9730:(e,t,s)=>{"use strict";s.d(t,{A:()=>m,AuthProvider:()=>o});var a=s(5155),l=s(2115),d=s(2553),r=s(550),i=s(9708),c=s(3136);let n=(0,l.createContext)({user:null,loading:!0}),o=e=>{let{children:t}=e,[s,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{let e=(0,d.hg)(r.j,async e=>{if(e){let s={...e};try{var t;if(null==(t=e.email)?void 0:t.endsWith("@rulemakers.co.kr"))s.role="superadmin";else{let t=(0,i.rJ)(r.db,"academies"),a=(0,i.P)(t,(0,i._M)("adminEmail","==",e.email),(0,i._M)("isDeleted","==",!1)),l=await (0,i.GG)(a);if(l.empty)await r.j.signOut(),s=null;else{let e=l.docs[0];s&&(s.role="academyadmin",s.academyId=e.id,s.academyName=e.data().name)}}}catch(e){console.error("Failed to fetch user role, signing out.",e),await r.j.signOut(),s=null}o(s)}else o(null);u(!1)});return()=>e()},[]),m)?(0,a.jsx)(c.A,{}):(0,a.jsx)(n.Provider,{value:{user:s,loading:m},children:t})},m=()=>(0,l.useContext)(n)}},e=>{e.O(0,[135,965,240,441,255,358],()=>e(e.s=7202)),_N_E=e.O()}]);