(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{3871:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),l=s(2115),d=s(9708),n=s(550),r=s(9730),i=s(2274),c=s(3136),o=s(8122);function x(){let{user:e,loading:t}=(0,r.A)(),s=(null==e?void 0:e.role)==="superadmin",[x,m]=(0,l.useState)([]),[h,u]=(0,l.useState)([]),[p,b]=(0,l.useState)([]),[f,j]=(0,l.useState)([]),[g,N]=(0,l.useState)([]),[v,y]=(0,l.useState)({}),[_,w]=(0,l.useState)(!0),[M,I]=(0,l.useState)(""),[S,k]=(0,l.useState)(""),[A,E]=(0,l.useState)(null),[C,D]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(e)if(s){let e=(0,d.aQ)((0,d.rJ)(n.db,"academies"),e=>m(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>e()}else e.academyId&&I(e.academyId)},[e,s]),(0,l.useEffect)(()=>{if(!M){u([]),k("");return}let e=(0,d.P)((0,d.rJ)(n.db,"classes"),(0,d._M)("academyId","==",M),(0,d._M)("isDeleted","==",!1)),t=(0,d.aQ)(e,e=>u(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>t()},[M]),(0,l.useEffect)(()=>{if(!S){b([]),j([]),N([]),w(!1);return}w(!0);let e=(0,d.P)((0,d.rJ)(n.db,"students"),(0,d._M)("classId","==",S),(0,d._M)("isDeleted","==",!1),(0,d._M)("status","==","active")),t=(0,d.P)((0,d.rJ)(n.db,"academyAssignments"),(0,d._M)("classId","==",S)),s=(0,d.P)((0,d.Cs)(n.db,"studentAssignments"),(0,d._M)("classId","==",S)),a=(0,d.aQ)(e,e=>b(e.docs.map(e=>({id:e.id,...e.data()})))),l=(0,d.aQ)(t,e=>j(e.docs.map(e=>({id:e.id,...e.data()})))),r=(0,d.aQ)(s,e=>{N(e.docs.map(e=>({id:e.id,...e.data()}))),w(!1)},e=>{console.error("제출 기록 조회 실패 (Firestore 색인이 필요할 수 있습니다): ",e),w(!1)});return()=>{a(),l(),r()}},[S]);let P=(0,l.useMemo)(()=>{let e=new Map;return g.forEach(t=>{let s=t.studentId||t.userId;s&&t.assignmentId&&e.set("".concat(s,"_").concat(t.assignmentId),t)}),e},[g]),J=async(e,t)=>{if(e&&t){D(!0);try{var s;let a=(0,d.P)((0,d.rJ)(n.db,"submissions"),(0,d._M)("userId","==",e),(0,d._M)("assignmentId","==",t),(0,d.AB)(1)),l=await (0,d.GG)(a);if(l.empty){alert("상세 결과 데이터를 찾을 수 없습니다."),D(!1);return}let r={id:l.docs[0].id,...l.docs[0].data()},i=(null==(s=r.questionIds)?void 0:s.filter(e=>!v[e]))||[];if(i.length>0){let e=[];for(let t=0;t<i.length;t+=30)e.push(i.slice(t,t+30));let t={};for(let s of e){let e=(0,d.P)((0,d.rJ)(n.db,"questionBank"),(0,d._M)("__name__","in",s));(await (0,d.GG)(e)).forEach(e=>t[e.id]={id:e.id,...e.data()})}y(e=>({...e,...t}))}E(r)}catch(e){console.error("상세 결과 로딩 중 오류 발생: ",e),alert("상세 결과를 불러오는 데 실패했습니다.")}finally{D(!1)}}};return t?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(c.A,{})}):(0,a.jsxs)("div",{className:"p-8 h-full overflow-y-auto bg-slate-50",children:[C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,a.jsx)(c.A,{})}),(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:"과제 현황"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:"수업별 학생들의 과제 제출 현황, 점수, 상세 결과를 확인합니다."})]}),(0,a.jsxs)("div",{className:"flex gap-4 mb-6 bg-white p-4 rounded-lg shadow-sm border border-slate-200",children:[s&&(0,a.jsxs)("select",{value:M,onChange:e=>I(e.target.value),className:"form-select",children:[(0,a.jsx)("option",{value:"",children:"학원 선택"}),x.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)("select",{value:S,onChange:e=>k(e.target.value),className:"form-select",disabled:!M,children:[(0,a.jsx)("option",{value:"",children:"수업 선택"}),h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),_?(0,a.jsx)(c.A,{}):S?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,a.jsxs)("thead",{className:"bg-slate-50",children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header text-left sticky left-0 bg-slate-50 z-10 px-4 py-3 min-w-[120px]",children:"학생 이름"}),f.sort((e,t)=>e.dueDate.toMillis()-t.dueDate.toMillis()).map(e=>(0,a.jsxs)("th",{colSpan:3,className:"table-header text-center px-4 py-3 border-l",title:e.title,children:[(0,a.jsx)("p",{className:"font-semibold",children:e.title}),(0,a.jsxs)("p",{className:"text-xs font-normal text-slate-500 mt-1",children:["마감: ",new Date(e.dueDate.toMillis()).toLocaleDateString("ko-KR")]})]},e.id))]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header sticky left-0 bg-slate-50 z-10 px-4 py-2"}),f.map(e=>(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)("th",{className:"table-header text-center px-4 py-2 border-l font-normal",children:"제출"}),(0,a.jsx)("th",{className:"table-header text-center px-4 py-2 font-normal",children:"점수"}),(0,a.jsx)("th",{className:"table-header text-center px-4 py-2 font-normal",children:"상세"})]},"".concat(e.id,"-sub")))]})]}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:p.length>0?p.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-medium text-slate-800 sticky left-0 bg-white z-10",children:e.studentName}),f.map(t=>{let s=P.get("".concat(e.id,"_").concat(t.id));return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-3 text-center border-l",children:s?(0,a.jsx)("span",{className:"text-green-600 font-bold text-lg",children:"✅"}):(0,a.jsx)("span",{className:"text-red-500 text-lg",children:"❌"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center text-sm",children:s?"".concat(s.score,"점"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:s&&(0,a.jsx)("button",{onClick:()=>J(e.id,t.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-50",title:"상세 결과 보기",children:(0,a.jsx)(o.jH2,{className:"w-4 h-4"})})})]},"".concat(t.id,"-").concat(e.id))})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:3*f.length+1,className:"py-16 text-center text-slate-500",children:"선택된 수업에 등록된 학생이 없습니다."})})})]})}),0===f.length&&p.length>0&&(0,a.jsx)("div",{className:"py-16 text-center text-slate-500",children:"아직 생성된 과제가 없습니다. '과제 관리' 페이지에서 과제를 생성해주세요."})]}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-16 text-center text-slate-500",children:s?(0,a.jsx)("p",{className:"text-lg",children:"현황을 보려면 학원과 수업을 선택해주세요."}):(0,a.jsx)("p",{className:"text-lg",children:"현황을 보려면 수업을 선택해주세요."})}),A&&(0,a.jsx)(i.A,{submission:A,student:p.find(e=>e.id===A.userId),questions:v,onClose:()=>E(null)})]})}},7202:(e,t,s)=>{Promise.resolve().then(s.bind(s,3871))}},e=>{e.O(0,[135,965,844,240,670,441,255,358],()=>e(e.s=7202)),_N_E=e.O()}]);