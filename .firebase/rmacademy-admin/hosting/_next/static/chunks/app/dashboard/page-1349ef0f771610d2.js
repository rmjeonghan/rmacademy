(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{40:(e,l,s)=>{Promise.resolve().then(s.bind(s,9485))},9485:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>m});var a=s(5155),t=s(2115),i=s(9708),d=s(550),n=s(8122),r=s(2274),c=s(3136),o=s(9730);function m(){let{user:e,loading:l}=(0,o.A)(),[s,m]=(0,t.useState)([]),[h,u]=(0,t.useState)({}),[x,b]=(0,t.useState)([]),[j,f]=(0,t.useState)({}),[N,p]=(0,t.useState)([]),[v,g]=(0,t.useState)("all"),[y,w]=(0,t.useState)(!1),[_,k]=(0,t.useState)(null),[I,S]=(0,t.useState)(!0),C=(0,t.useCallback)(async()=>{if(e){S(!0);try{let l=await (0,i.GG)((0,i.rJ)(d.db,"students")),s={};if(l.forEach(e=>s[e.id]={id:e.id,...e.data()}),u(s),"superadmin"===e.role){let e=(0,i.P)((0,i.rJ)(d.db,"academies"),(0,i._M)("isDeleted","==",!1)),l=(await (0,i.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));b(l)}let a=[];if("academyadmin"===e.role&&e.academyId){let l=Object.values(s).filter(l=>l.academyId===e.academyId).map(e=>e.id);if(l.length>0){let e=[];for(let s=0;s<l.length;s+=30){let a=l.slice(s,s+30),t=(0,i.P)((0,i.rJ)(d.db,"submissions"),(0,i._M)("userId","in",a));e.push((0,i.GG)(t))}a=(await Promise.all(e)).flatMap(e=>e.docs.map(e=>({id:e.id,...e.data()})))}}else{let e=(0,i.P)((0,i.rJ)(d.db,"submissions"));a=(await (0,i.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}a.sort((e,l)=>l.createdAt.toMillis()-e.createdAt.toMillis()),m(a)}catch(e){console.error("데이터 로딩 중 오류 발생:",e)}finally{S(!1)}}},[e]);(0,t.useEffect)(()=>{!l&&e&&C()},[e,l,C]),(0,t.useEffect)(()=>{let l=s;if((null==e?void 0:e.role)==="superadmin"&&"all"!==v){let e=Object.values(h).filter(e=>e.academyId===v).map(e=>e.id);l=l.filter(l=>e.includes(l.userId))}y||(l=l.filter(e=>!e.isDeleted)),p(l)},[s,v,y,h,e]);let D=async e=>{let l=e.questionIds.filter(e=>!j[e]);if(l.length>0){let e=[];for(let s=0;s<l.length;s+=30)e.push(l.slice(s,s+30));let s={};for(let l of e){let e=(0,i.P)((0,i.rJ)(d.db,"questionBank"),(0,i._M)("__name__","in",l));(await (0,i.GG)(e)).forEach(e=>s[e.id]={id:e.id,...e.data()})}f(e=>({...e,...s}))}k(e)},G=async(e,l)=>{await (0,i.mZ)((0,i.H9)(d.db,"submissions",e),{isDeleted:!l}),m(s=>s.map(s=>s.id===e?{...s,isDeleted:!l}:s))};return l||I?(0,a.jsx)(c.A,{}):(0,a.jsxs)("div",{className:"p-8 overflow-y-auto h-full bg-gray-50",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:"결과 대시보드"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:"학생 답안을 확인하고 관리합니다."})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6 flex justify-between items-center border border-slate-200",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(null==e?void 0:e.role)==="superadmin"&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"filterAcademy",className:"block text-sm font-medium text-gray-700 mb-1",children:"학원 필터"}),(0,a.jsxs)("select",{id:"filterAcademy",value:v,onChange:e=>g(e.target.value),className:"form-select",children:[(0,a.jsx)("option",{value:"all",children:"전체 학원"}),x.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>w(!y),className:"btn-secondary",children:[y?(0,a.jsx)(n._NO,{className:"inline mr-2"}):(0,a.jsx)(n.Vap,{className:"inline mr-2"}),y?"숨김 기록 숨기기":"숨김 기록 보기"]}),(0,a.jsx)("button",{onClick:C,className:"btn-secondary",title:"새로고침",children:(0,a.jsx)(n.jTZ,{className:"inline"})})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header",children:"제출일시"}),(0,a.jsx)("th",{className:"table-header",children:"학습 정보"}),(null==e?void 0:e.role)==="superadmin"&&(0,a.jsx)("th",{className:"table-header",children:"학원"}),(0,a.jsx)("th",{className:"table-header",children:"학생"}),(0,a.jsx)("th",{className:"table-header",children:"점수"}),(0,a.jsx)("th",{className:"table-header",children:"관리"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:N.length>0?N.map(l=>{if(!l||!l.id)return null;let s=h[l.userId],t=x.find(e=>e.id===(null==s?void 0:s.academyId));return(0,a.jsxs)("tr",{className:"hover:bg-slate-50 ".concat(l.isDeleted?"bg-gray-50 text-gray-400":""),children:[(0,a.jsx)("td",{className:"table-cell",children:new Date(l.createdAt.toMillis()).toLocaleString("ko-KR")}),(0,a.jsxs)("td",{className:"table-cell",children:[l.mainChapter," (",l.assignmentId?"과제":"자율학습",")"]}),(null==e?void 0:e.role)==="superadmin"&&(0,a.jsx)("td",{className:"table-cell",children:(null==t?void 0:t.name)||"개인"}),(0,a.jsx)("td",{className:"table-cell font-medium",children:(null==s?void 0:s.studentName)||"알 수 없음"}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:[l.score,"점"]})}),(0,a.jsxs)("td",{className:"table-cell space-x-2",children:[(0,a.jsx)("button",{onClick:()=>D(l),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50 transition-colors",title:"상세 보기",children:(0,a.jsx)(n.jH2,{className:"inline w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>G(l.id,l.isDeleted),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat(l.isDeleted?"text-green-600 hover:text-green-800":"text-gray-500 hover:text-gray-700"),title:l.isDeleted?"복구":"숨김",children:l.isDeleted?(0,a.jsx)(n.Vap,{className:"inline w-4 h-4"}):(0,a.jsx)(n._NO,{className:"inline w-4 h-4"})})]})]},l.id)}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:(null==e?void 0:e.role)==="superadmin"?6:5,className:"text-center py-16 text-slate-500",children:"표시할 데이터가 없습니다."})})})]})})}),_&&(0,a.jsx)(r.A,{submission:_,student:h[_.userId],questions:j,onClose:()=>k(null)})]})}}},e=>{e.O(0,[135,965,844,240,670,441,255,358],()=>e(e.s=40)),_N_E=e.O()}]);