(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[100],{7054:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>u});var a=l(5155),t=l(2115),d=l(9708),i=l(550),n=l(8122),c=l(3136),r=l(2274);function o(e){let{title:s,children:l,className:t,titleClassName:d,bodyClassName:i}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm ".concat(t),children:[s&&(0,a.jsx)("div",{className:"p-4 sm:p-5 border-b border-slate-200 ".concat(d),children:(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:s})}),(0,a.jsx)("div",{className:"p-4 sm:p-5 ".concat(i),children:l})]})}var m=l(9730);function u(){let{user:e,loading:s}=(0,m.A)(),[l,u]=(0,t.useState)([]),[h,x]=(0,t.useState)({}),[b,j]=(0,t.useState)([]),[f,N]=(0,t.useState)({}),[p,v]=(0,t.useState)([]),[g,y]=(0,t.useState)("all"),[w,_]=(0,t.useState)(!1),[k,S]=(0,t.useState)(!0),[C,I]=(0,t.useState)(null),D=(0,t.useCallback)(async()=>{if(e){S(!0);try{let s=await (0,d.GG)((0,d.rJ)(i.db,"students")),l={};if(s.forEach(e=>l[e.id]={id:e.id,...e.data()}),x(l),"superadmin"===e.role){let e=await (0,d.GG)((0,d.P)((0,d.rJ)(i.db,"academies"),(0,d._M)("isDeleted","==",!1)));j(e.docs.map(e=>({id:e.id,...e.data()})))}}catch(e){console.error("학생/학원 정보 로딩 오류:",e)}finally{S(!1)}}},[e]);(0,t.useEffect)(()=>{if(!s&&e){let s;D(),s="academyadmin"===e.role&&e.academyId?(0,d.P)((0,d.rJ)(i.db,"submissions"),(0,d._M)("academyId","==",e.academyId),(0,d.My)("createdAt","desc")):(0,d.P)((0,d.rJ)(i.db,"submissions"),(0,d.My)("createdAt","desc"));let l=(0,d.aQ)(s,e=>{u(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>l()}},[e,s,D]),(0,t.useEffect)(()=>{let s=l;if((null==e?void 0:e.role)==="superadmin"&&"all"!==g){let e=Object.values(h).filter(e=>e.academyId===g).map(e=>e.id);s=s.filter(s=>e.includes(s.userId))}w||(s=s.filter(e=>!e.isDeleted)),v(s)},[l,g,w,h,e]);let E=async e=>{let s=e.questionIds.filter(e=>!f[e]);if(s.length>0){let e=[];for(let l=0;l<s.length;l+=30)e.push(s.slice(l,l+30));let l={};for(let s of e){let e=(0,d.P)((0,d.rJ)(i.db,"questionBank"),(0,d._M)("__name__","in",s));(await (0,d.GG)(e)).forEach(e=>l[e.id]={id:e.id,...e.data()})}N(e=>({...e,...l}))}I(e)},A=async(e,s)=>{await (0,d.mZ)((0,d.H9)(i.db,"submissions",e),{isDeleted:!s})};return s||k?(0,a.jsx)(c.A,{}):(0,a.jsxs)("div",{className:"p-8 h-full overflow-y-auto",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:"전체 결과 보기"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:"학생들의 전체 제출 기록을 확인합니다."})]}),(0,a.jsxs)(o,{children:[(0,a.jsxs)("div",{className:"p-4 flex justify-between items-center border-b border-slate-200",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(null==e?void 0:e.role)==="superadmin"&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.K7R,{className:"text-slate-500"}),(0,a.jsxs)("select",{value:g,onChange:e=>y(e.target.value),className:"form-select text-sm",children:[(0,a.jsx)("option",{value:"all",children:"전체 학원"}),b.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,a.jsxs)("button",{onClick:()=>_(!w),className:"btn-secondary text-sm",children:[w?(0,a.jsx)(n._NO,{className:"inline mr-2"}):(0,a.jsx)(n.Vap,{className:"inline mr-2"}),w?"숨김 기록 숨기기":"숨김 기록 보기"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header",children:"제출일시"}),(0,a.jsx)("th",{className:"table-header",children:"학습 정보"}),(null==e?void 0:e.role)==="superadmin"&&(0,a.jsx)("th",{className:"table-header",children:"학원"}),(0,a.jsx)("th",{className:"table-header",children:"학생"}),(0,a.jsx)("th",{className:"table-header",children:"점수"}),(0,a.jsx)("th",{className:"table-header",children:"관리"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:p.length>0?p.map(s=>{let l=h[s.userId],t=b.find(e=>e.id===(null==l?void 0:l.academyId));return(0,a.jsxs)("tr",{onClick:()=>E(s),className:"cursor-pointer hover:bg-slate-50 ".concat(s.isDeleted?"bg-gray-100 text-gray-400":""),children:[(0,a.jsx)("td",{className:"table-cell",children:new Date(s.createdAt.toMillis()).toLocaleString("ko-KR")}),(0,a.jsxs)("td",{className:"table-cell",children:[s.mainChapter," (",s.assignmentId?"과제":"자율학습",")"]}),(null==e?void 0:e.role)==="superadmin"&&(0,a.jsx)("td",{className:"table-cell",children:(null==t?void 0:t.name)||"개인"}),(0,a.jsx)("td",{className:"table-cell font-medium text-slate-800",children:(null==l?void 0:l.studentName)||"알 수 없음"}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:[s.score,"점"]})}),(0,a.jsx)("td",{className:"table-cell",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("button",{onClick:()=>A(s.id,s.isDeleted),className:"text-xs font-semibold rounded-full px-3 py-1 ".concat(s.isDeleted?"bg-green-100 text-green-700":"bg-slate-100 text-slate-600"),children:s.isDeleted?"복구":"숨김"})})]},s.id)}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:(null==e?void 0:e.role)==="superadmin"?6:5,className:"text-center py-16 text-slate-500",children:"표시할 데이터가 없습니다."})})})]})})]}),C&&(0,a.jsx)(r.A,{submission:C,student:h[C.userId],questions:f,onClose:()=>I(null)})]})}},8541:(e,s,l)=>{Promise.resolve().then(l.bind(l,7054))}},e=>{e.O(0,[135,965,844,240,670,441,255,358],()=>e(e.s=8541)),_N_E=e.O()}]);