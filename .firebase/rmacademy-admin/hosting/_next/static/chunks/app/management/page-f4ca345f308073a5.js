(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[972],{550:(e,t,s)=>{"use strict";s.d(t,{db:()=>i,j:()=>c});var a=s(2078),r=s(9708),l=s(2553);let n=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyC5SUu7e-aNUfgBEeEoXEwjONknWKhbtBI",authDomain:"rmcheck-4e79c.firebaseapp.com",projectId:"rmcheck-4e79c",storageBucket:"rmcheck-4e79c.firebasestorage.app",messagingSenderId:"1081522017302",appId:"1:1081522017302:web:b7bd3e0436a05c92c29137"}),i=(0,r.aU)(n),c=(0,l.xI)(n)},3136:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(){return(0,a.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-[var(--primary)] rounded-full animate-spin"})})}},6529:(e,t,s)=>{Promise.resolve().then(s.bind(s,7324))},6724:(e,t,s)=>{"use strict";s.d(t,{k5:()=>o});var a=s(2115),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=a.createContext&&a.createContext(r),n=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach(function(t){var a,r,l;a=e,r=t,l=s[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(r))in a?Object.defineProperty(a,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[r]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function o(e){return t=>a.createElement(m,i({attr:d({},e.attr)},t),function e(t){return t&&t.map((t,s)=>a.createElement(t.tag,d({key:s},t.attr),e(t.child)))}(e.child))}function m(e){var t=t=>{var s,{attr:r,size:l,title:c}=e,o=function(e,t){if(null==e)return{};var s,a,r=function(e,t){if(null==e)return{};var s={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;s[a]=e[a]}return s}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)s=l[a],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}(e,n),m=l||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),a.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:s,style:d(d({color:e.color||t.color},t.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),c&&a.createElement("title",null,c),e.children)};return void 0!==l?a.createElement(l.Consumer,null,e=>t(e)):t(r)}},7324:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(5155),r=s(2115),l=s(9708),n=s(550),i=s(8122),c=s(3136),d=s(9730);function o(){let{user:e,loading:t}=(0,d.A)(),s=(null==e?void 0:e.role)==="superadmin",[o,m]=(0,r.useState)([]),[u,p]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[f,b]=(0,r.useState)([]),[j,v]=(0,r.useState)({page:!0,students:!1}),[y,g]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[O,S]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[P,E]=(0,r.useState)({}),D=(0,r.useCallback)(async()=>{if(e){v(e=>({...e,page:!0}));try{if(s){let e=(0,l.P)((0,l.rJ)(n.db,"academies"),(0,l._M)("isDeleted","==",!1),(0,l.My)("name")),t=(await (0,l.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));m(t),t.length>0&&!y&&g(t[0].id)}else e.academyId&&g(e.academyId)}catch(e){console.error("학원 데이터 로드 실패:",e)}finally{v(e=>({...e,page:!1}))}}},[e,s,y]),I=(0,r.useCallback)(async()=>{if(!y){p([]),h([]),b([]);return}v(e=>({...e,students:!0}));try{let e=(0,l.P)((0,l.rJ)(n.db,"classes"),(0,l._M)("academyId","==",y),(0,l._M)("isDeleted","==",!1),(0,l.My)("name")),t=await (0,l.GG)(e);p(t.docs.map(e=>({id:e.id,...e.data()})));let s=(0,l.P)((0,l.rJ)(n.db,"students"),(0,l._M)("academyId","==",y),(0,l._M)("isDeleted","==",!1)),a=(await (0,l.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));h(a.filter(e=>"active"===e.status)),b(a.filter(e=>"pending"===e.status))}catch(e){console.error("반/학생 목록 로드 실패: ",e)}finally{v(e=>({...e,students:!1}))}},[y]);(0,r.useEffect)(()=>{t||D()},[t,D]),(0,r.useEffect)(()=>{I()},[I]);let _=async e=>{e.preventDefault(),N.trim()&&O.trim()&&(await (0,l.gS)((0,l.rJ)(n.db,"academies"),{name:N,adminEmail:O,isDeleted:!1,createdAt:(0,l.O5)()}),w(""),S(""),D())},G=async e=>{e.preventDefault(),k.trim()&&y&&(await (0,l.gS)((0,l.rJ)(n.db,"classes"),{academyId:y,name:k,isDeleted:!1,createdAt:(0,l.O5)()}),C(""),I())},A=async(e,t)=>{window.confirm("academies"===e?"학원을 삭제하면 복구할 수 없습니다. 계속하시겠습니까?":"반을 삭제하시겠습니까?")&&(await (0,l.mZ)((0,l.H9)(n.db,e,t),{isDeleted:!0}),"academies"===e?D():I())},M=async(e,t)=>{let s=P[e];if("approve"===t&&!s)return void alert("학생을 승인하려면 먼저 반을 배정해야 합니다.");if(("reject"===t||"delete"===t)&&!window.confirm({reject:"정말로 이 학생의 가입 요청을 거절하시겠습니까?",delete:"정말로 이 학생을 학원에서 삭제(탈퇴) 처리하시겠습니까?"}[t]))return;let a={approve:{status:"active",classId:s},reject:{isDeleted:!0,status:"rejected"},delete:{isDeleted:!0,status:"deleted"}}[t];await (0,l.mZ)((0,l.H9)(n.db,"students",e),a),I()},J=async(e,t)=>{t&&(await (0,l.mZ)((0,l.H9)(n.db,"students",e),{classId:t}),h(s=>s.map(s=>s.id===e?{...s,classId:t}:s)))};return t||j.page?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(c.A,{})}):(0,a.jsxs)("div",{className:"p-8 h-full overflow-y-auto bg-slate-50",children:[(0,a.jsxs)("header",{className:"mb-8 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:s?"학원 및 학생 관리":"수업 및 학생 관리"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:s?"학원을 등록하고 학원별 정보를 관리합니다.":"소속 학원의 수업과 학생을 관리합니다."})]}),(0,a.jsx)("button",{onClick:()=>{D(),I()},className:"btn-secondary",title:"새로고침",children:(0,a.jsx)(i.jTZ,{className:"inline"})})]}),s&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"form-label",children:"관리할 학원 선택"}),(0,a.jsx)("select",{value:y,onChange:e=>g(e.target.value),className:"form-select max-w-xs",children:o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-8",children:[s&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"학원 관리"}),(0,a.jsxs)("form",{onSubmit:_,className:"mb-4 space-y-3",children:[(0,a.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"새 학원 이름",className:"form-input"}),(0,a.jsx)("input",{type:"email",value:O,onChange:e=>S(e.target.value),placeholder:"관리자 이메일",className:"form-input"}),(0,a.jsxs)("button",{type:"submit",className:"btn-primary w-full",children:[(0,a.jsx)(i.GGD,{className:"inline mr-2"}),"학원 추가"]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"반 관리"}),(0,a.jsxs)("form",{onSubmit:G,className:"flex gap-2 mb-4",children:[(0,a.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"새 반 이름",className:"form-input",disabled:!y}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:!y,children:(0,a.jsx)(i.GGD,{})})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[u.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"font-medium text-slate-700",children:e.name}),(0,a.jsx)("button",{onClick:()=>A("classes",e.id),className:"p-2 text-red-500 hover:bg-red-100 rounded-full",title:"반 삭제",children:(0,a.jsx)(i.IXo,{})})]},e.id)),0===u.length&&(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:"등록된 반이 없습니다."})]})]})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"가입 대기 학생"}),(0,a.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:j.students?(0,a.jsx)(c.A,{}):f.length>0?f.map(e=>(0,a.jsxs)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium text-yellow-800",children:e.studentName}),(0,a.jsxs)("div",{className:"space-x-1",children:[(0,a.jsx)("button",{onClick:()=>M(e.id,"approve"),className:"p-2 text-green-600 hover:bg-green-100 rounded-full",title:"승인",children:(0,a.jsx)(i.p45,{})}),(0,a.jsx)("button",{onClick:()=>M(e.id,"reject"),className:"p-2 text-red-600 hover:bg-red-100 rounded-full",title:"거절",children:(0,a.jsx)(i.JOY,{})})]})]}),(0,a.jsxs)("select",{value:P[e.id]||"",onChange:t=>E(s=>({...s,[e.id]:t.target.value})),className:"form-select text-sm",children:[(0,a.jsx)("option",{value:"",children:"배정할 반을 선택하세요"}),u.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]},e.id)):(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:"가입 대기 중인 학생이 없습니다."})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"등록 학생 관리"}),(0,a.jsx)("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:j.students?(0,a.jsx)(c.A,{}):x.length>0?x.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-3 items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"font-medium text-slate-700 col-span-1",children:e.studentName}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsxs)("select",{value:e.classId||"",onChange:t=>J(e.id,t.target.value),className:"form-select text-sm w-full",children:[(0,a.jsx)("option",{value:"",children:"반 미배정"}),u.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,a.jsx)("div",{className:"text-right col-span-1",children:(0,a.jsx)("button",{onClick:()=>M(e.id,"delete"),className:"p-2 text-red-500 hover:bg-red-100 rounded-full",title:"학생 삭제",children:(0,a.jsx)(i.IXo,{})})})]},e.id)):(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:"등록된 학생이 없습니다."})})]})]})]})]})}},9730:(e,t,s)=>{"use strict";s.d(t,{A:()=>m,AuthProvider:()=>o});var a=s(5155),r=s(2115),l=s(2553),n=s(550),i=s(9708),c=s(3136);let d=(0,r.createContext)({user:null,loading:!0}),o=e=>{let{children:t}=e,[s,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=(0,l.hg)(n.j,async e=>{if(e){let s={...e};try{var t;if(null==(t=e.email)?void 0:t.endsWith("@rulemakers.co.kr"))s.role="superadmin";else{let t=(0,i.rJ)(n.db,"academies"),a=(0,i.P)(t,(0,i._M)("adminEmail","==",e.email),(0,i._M)("isDeleted","==",!1)),r=await (0,i.GG)(a);if(r.empty)await n.j.signOut(),s=null;else{let e=r.docs[0];s&&(s.role="academyadmin",s.academyId=e.id,s.academyName=e.data().name)}}}catch(e){console.error("Failed to fetch user role, signing out.",e),await n.j.signOut(),s=null}o(s)}else o(null);u(!1)});return()=>e()},[]),m)?(0,a.jsx)(c.A,{}):(0,a.jsx)(d.Provider,{value:{user:s,loading:m},children:t})},m=()=>(0,r.useContext)(d)}},e=>{e.O(0,[135,965,844,240,441,255,358],()=>e(e.s=6529)),_N_E=e.O()}]);