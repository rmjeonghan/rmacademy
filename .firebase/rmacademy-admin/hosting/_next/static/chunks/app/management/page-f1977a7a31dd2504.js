(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[972],{550:(e,t,s)=>{"use strict";s.d(t,{db:()=>n,j:()=>d});var a=s(2078),l=s(9708),r=s(2553);let i=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyC5SUu7e-aNUfgBEeEoXEwjONknWKhbtBI",authDomain:"rmcheck-4e79c.firebaseapp.com",projectId:"rmcheck-4e79c",storageBucket:"rmcheck-4e79c.firebasestorage.app",messagingSenderId:"1081522017302",appId:"1:1081522017302:web:b7bd3e0436a05c92c29137"}),n=(0,l.aU)(i),d=(0,r.xI)(i)},3136:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155);function l(){return(0,a.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-[var(--primary)] rounded-full animate-spin"})})}},6529:(e,t,s)=>{Promise.resolve().then(s.bind(s,7324))},6724:(e,t,s)=>{"use strict";s.d(t,{k5:()=>o});var a=s(2115),l={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=a.createContext&&a.createContext(l),i=["attr","size","title"];function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function d(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?d(Object(s),!0).forEach(function(t){var a,l,r;a=e,l=t,r=s[t],(l=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(l))in a?Object.defineProperty(a,l,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[l]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function o(e){return t=>a.createElement(m,n({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,s)=>a.createElement(t.tag,c({key:s},t.attr),e(t.child)))}(e.child))}function m(e){var t=t=>{var s,{attr:l,size:r,title:d}=e,o=function(e,t){if(null==e)return{};var s,a,l=function(e,t){if(null==e)return{};var s={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;s[a]=e[a]}return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(l[s]=e[s])}return l}(e,i),m=r||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),a.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,l,o,{className:s,style:c(c({color:e.color||t.color},t.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),d&&a.createElement("title",null,d),e.children)};return void 0!==r?a.createElement(r.Consumer,null,e=>t(e)):t(l)}},7324:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(5155),l=s(2115),r=s(9708),i=s(550),n=s(8122),d=s(3136),c=s(9730);function o(){let{user:e,loading:t}=(0,c.A)(),s=(null==e?void 0:e.role)==="superadmin",[o,m]=(0,l.useState)([]),[u,x]=(0,l.useState)([]),[h,f]=(0,l.useState)([]),[b,p]=(0,l.useState)([]),[j,y]=(0,l.useState)({page:!0,students:!1,academies:!1}),[g,v]=(0,l.useState)(""),[w,N]=(0,l.useState)(!1),[O,k]=(0,l.useState)(""),[C,P]=(0,l.useState)(""),[I,S]=(0,l.useState)(""),[D,G]=(0,l.useState)({}),E=(0,l.useCallback)(async()=>{if(s){y(e=>({...e,academies:!0}));try{let e=(0,r.P)((0,r.rJ)(i.db,"academies"),(0,r._M)("isDeleted","==",w),(0,r.My)("name")),t=await (0,r.GG)(e),s=await Promise.all(t.docs.map(async e=>{let t={id:e.id,...e.data()},s=(0,r.P)((0,r.rJ)(i.db,"classes"),(0,r._M)("academyId","==",t.id),(0,r._M)("isDeleted","==",!1)),a=await (0,r.GG)(s),l=(0,r.P)((0,r.rJ)(i.db,"students"),(0,r._M)("academyId","==",t.id),(0,r._M)("isDeleted","==",!1)),n=await (0,r.GG)(l);return{...t,classCount:a.size,studentCount:n.size}}));m(s),!(s.length>0)||g||w||v(s[0].id)}catch(e){console.error("학원 상세 데이터 로드 실패:",e)}finally{y(e=>({...e,academies:!1}))}}},[s,g,w]),_=(0,l.useCallback)(async()=>{if(e){y(e=>({...e,page:!0}));try{s?await E():e.academyId&&v(e.academyId)}catch(e){console.error("초기 데이터 로드 실패:",e)}finally{y(e=>({...e,page:!1}))}}},[e,s,E]),M=(0,l.useCallback)(async()=>{if(!g){x([]),f([]),p([]);return}y(e=>({...e,students:!0}));try{let e=(0,r.P)((0,r.rJ)(i.db,"classes"),(0,r._M)("academyId","==",g),(0,r._M)("isDeleted","==",w),(0,r.My)("name")),t=await (0,r.GG)(e);if(x(t.docs.map(e=>({id:e.id,...e.data()}))),w){let e=(0,r.P)((0,r.rJ)(i.db,"students"),(0,r._M)("academyId","==",g),(0,r._M)("isDeleted","==",!0)),t=await (0,r.GG)(e);f(t.docs.map(e=>({id:e.id,...e.data()}))),p([])}else{let e=(0,r.P)((0,r.rJ)(i.db,"students"),(0,r._M)("academyId","==",g),(0,r._M)("isDeleted","==",!1)),t=(await (0,r.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));f(t.filter(e=>"active"===e.status)),p(t.filter(e=>"pending"===e.status))}}catch(e){console.error("반/학생 목록 로드 실패: ",e)}finally{y(e=>({...e,students:!1}))}},[g,w]);(0,l.useEffect)(()=>{t||_()},[t,_,w]),(0,l.useEffect)(()=>{M()},[M,w]);let J=async e=>{e.preventDefault(),O.trim()&&C.trim()&&(await (0,r.gS)((0,r.rJ)(i.db,"academies"),{name:O,adminEmail:C,isDeleted:!1,createdAt:(0,r.O5)()}),k(""),P(""),_())},A=async e=>{e.preventDefault(),I.trim()&&g&&(await (0,r.gS)((0,r.rJ)(i.db,"classes"),{academyId:g,name:I,isDeleted:!1,createdAt:(0,r.O5)()}),S(""),M(),s&&E())},H=async(e,t,a)=>{if(window.confirm({academies:{soft:"학원을 삭제(숨김) 처리하시겠습니까? 나중에 복구할 수 있습니다.",hard:"학원을 영구적으로 삭제합니다. 관련된 모든 반, 학생 정보가 함께 삭제되며 복구할 수 없습니다. 계속하시겠습니까?"},classes:{soft:"반을 삭제(숨김) 처리하시겠습니까?",hard:"반을 영구적으로 삭제합니다. 소속된 학생들의 반 정보가 초기화됩니다. 계속하시겠습니까?"},students:{soft:"학생을 삭제(탈퇴) 처리하시겠습니까?",hard:"학생 정보를 영구적으로 삭제하시겠습니까? 복구할 수 없습니다."}}[e][a]))try{if("soft"===a)await (0,r.mZ)((0,r.H9)(i.db,e,t),{isDeleted:!0});else if("academies"===e){let e=(0,r.wP)(i.db),s=(0,r.P)((0,r.rJ)(i.db,"classes"),(0,r._M)("academyId","==",t));(await (0,r.GG)(s)).forEach(t=>e.delete(t.ref));let a=(0,r.P)((0,r.rJ)(i.db,"students"),(0,r._M)("academyId","==",t));(await (0,r.GG)(a)).forEach(t=>e.delete(t.ref)),e.delete((0,r.H9)(i.db,"academies",t)),await e.commit()}else if("classes"===e){let e=(0,r.wP)(i.db),s=(0,r.P)((0,r.rJ)(i.db,"students"),(0,r._M)("classId","==",t));(await (0,r.GG)(s)).forEach(t=>{e.update(t.ref,{classId:""})}),e.delete((0,r.H9)(i.db,"classes",t)),await e.commit()}else await (0,r.kd)((0,r.H9)(i.db,e,t));"academies"===e?_():(M(),s&&E())}catch(t){console.error("".concat(e," 삭제 실패:"),t),alert("삭제 중 오류가 발생했습니다.")}},F=async(e,t)=>{if(window.confirm("이 항목을 복구하시겠습니까?"))try{await (0,r.mZ)((0,r.H9)(i.db,e,t),{isDeleted:!1}),"academies"===e?_():M()}catch(t){console.error("".concat(e," 복구 실패:"),t),alert("복구 중 오류가 발생했습니다.")}},z=async(e,t)=>{if("approve"===t){let t=D[e];if(!t)return void alert("먼저 배정할 반을 선택해야 합니다.");if(window.confirm("이 학생의 가입을 승인하시겠습니까?"))try{await (0,r.mZ)((0,r.H9)(i.db,"students",e),{status:"active",classId:t}),G(t=>{let s={...t};return delete s[e],s}),M(),s&&E()}catch(e){console.error("학생 승인 실패:",e),alert("학생 승인 중 오류가 발생했습니다.")}}else if("reject"===t&&window.confirm("이 학생의 가입 요청을 거절하시겠습니까? 해당 정보는 영구적으로 삭제됩니다."))try{await (0,r.kd)((0,r.H9)(i.db,"students",e)),M(),s&&E()}catch(e){console.error("학생 거절(삭제) 실패:",e),alert("학생 거절 처리 중 오류가 발생했습니다.")}},T=async(e,t)=>{if(t)try{await (0,r.mZ)((0,r.H9)(i.db,"students",e),{classId:t}),f(s=>s.map(s=>s.id===e?{...s,classId:t}:s))}catch(e){console.error("학생 반 변경 실패: ",e),alert("학생 반 변경 중 오류가 발생했습니다.")}};return t||j.page?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(d.A,{})}):(0,a.jsxs)("div",{className:"p-8 h-full overflow-y-auto bg-slate-50",children:[(0,a.jsxs)("header",{className:"mb-8 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-lexend text-slate-800",children:s?"통합 관리":"수업 및 학생 관리"}),(0,a.jsx)("p",{className:"mt-2 text-md text-slate-500",children:s?"전체 학원 현황을 보고 관리합니다.":"소속 학원의 수업과 학생을 관리합니다."})]}),(0,a.jsx)("button",{onClick:()=>{_(),M()},className:"btn-secondary",title:"새로고침",children:(0,a.jsx)(n.jTZ,{className:"inline"})})]}),(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-end",children:[(0,a.jsx)("label",{htmlFor:"showDeleted",className:"mr-2 text-sm font-medium text-slate-600",children:"삭제된 항목 보기"}),(0,a.jsx)("input",{type:"checkbox",id:"showDeleted",checked:w,onChange:e=>N(e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"})]}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-8 bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:w?"삭제된 학원":"학원 현황"}),(0,a.jsxs)("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:[j.academies?(0,a.jsx)(d.A,{}):o.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"font-semibold text-slate-800 col-span-1",children:e.name}),!w&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["반 ",e.classCount,"개"]}),(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["학생 ",e.studentCount,"명"]})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-2 ".concat(w?"col-start-4":""),children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>F("academies",e.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-full",title:"학원 복구",children:(0,a.jsx)(n.cO3,{})}),(0,a.jsx)("button",{onClick:()=>H("academies",e.id,"hard"),className:"p-2 text-red-600 hover:bg-red-100 rounded-full",title:"학원 영구 삭제",children:(0,a.jsx)(n.eHT,{})})]}):(0,a.jsx)("button",{onClick:()=>H("academies",e.id,"soft"),className:"p-2 text-yellow-600 hover:bg-yellow-100 rounded-full",title:"학원 숨기기",children:(0,a.jsx)(n.IXo,{})})})]},e.id)),0===o.length&&!j.academies&&(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:w?"삭제된 학원이 없습니다.":"등록된 학원이 없습니다."})]})]}),!w&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"form-label",children:"관리할 학원 선택"}),(0,a.jsxs)("select",{value:g,onChange:e=>v(e.target.value),className:"form-select max-w-xs",children:[(0,a.jsx)("option",{value:"",children:"학원을 선택하세요"}),o.filter(e=>!e.isDeleted).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-8",children:[s&&!w&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"신규 학원 등록"}),(0,a.jsxs)("form",{onSubmit:J,className:"mb-4 space-y-3",children:[(0,a.jsx)("input",{type:"text",value:O,onChange:e=>k(e.target.value),placeholder:"새 학원 이름",className:"form-input"}),(0,a.jsx)("input",{type:"email",value:C,onChange:e=>P(e.target.value),placeholder:"관리자 이메일",className:"form-input"}),(0,a.jsxs)("button",{type:"submit",className:"btn-primary w-full",children:[(0,a.jsx)(n.GGD,{className:"inline mr-2"}),"학원 추가"]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:w?"삭제된 반":"반 관리"}),!w&&(0,a.jsxs)("form",{onSubmit:A,className:"flex gap-2 mb-4",children:[(0,a.jsx)("input",{type:"text",value:I,onChange:e=>S(e.target.value),placeholder:"새 반 이름",className:"form-input",disabled:!g}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",disabled:!g,children:(0,a.jsx)(n.GGD,{})})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[u.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"font-medium text-slate-700",children:e.name}),(0,a.jsx)("div",{className:"flex space-x-2",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>F("classes",e.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-full",title:"반 복구",children:(0,a.jsx)(n.cO3,{})}),(0,a.jsx)("button",{onClick:()=>H("classes",e.id,"hard"),className:"p-2 text-red-600 hover:bg-red-100 rounded-full",title:"반 영구 삭제",children:(0,a.jsx)(n.eHT,{})})]}):(0,a.jsx)("button",{onClick:()=>H("classes",e.id,"soft"),className:"p-2 text-yellow-600 hover:bg-yellow-100 rounded-full",title:"반 숨기기",children:(0,a.jsx)(n.IXo,{})})})]},e.id)),0===u.length&&(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:w?"삭제된 반이 없습니다.":"등록된 반이 없습니다."})]})]})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[!w&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:"가입 대기 학생"}),(0,a.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:j.students?(0,a.jsx)(d.A,{}):b.length>0?b.map(e=>(0,a.jsxs)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium text-yellow-800",children:e.studentName}),(0,a.jsxs)("div",{className:"space-x-1",children:[(0,a.jsx)("button",{onClick:()=>z(e.id,"approve"),className:"p-2 text-green-600 hover:bg-green-100 rounded-full",title:"승인",children:(0,a.jsx)(n.p45,{})}),(0,a.jsx)("button",{onClick:()=>z(e.id,"reject"),className:"p-2 text-red-600 hover:bg-red-100 rounded-full",title:"거절",children:(0,a.jsx)(n.JOY,{})})]})]}),(0,a.jsxs)("select",{value:D[e.id]||"",onChange:t=>G(s=>({...s,[e.id]:t.target.value})),className:"form-select text-sm",children:[(0,a.jsx)("option",{value:"",children:"배정할 반을 선택하세요"}),u.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]},e.id)):(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:"가입 대기 중인 학생이 없습니다."})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 font-lexend text-slate-700",children:w?"삭제된 학생":"등록 학생 관리"}),(0,a.jsx)("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:j.students?(0,a.jsx)(d.A,{}):h.length>0?h.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-3 items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"font-medium text-slate-700 col-span-1",children:e.studentName}),(0,a.jsx)("div",{className:"col-span-1",children:!w&&(0,a.jsxs)("select",{value:e.classId||"",onChange:t=>T(e.id,t.target.value),className:"form-select text-sm w-full",children:[(0,a.jsx)("option",{value:"",children:"반 미배정"}),u.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,a.jsx)("div",{className:"text-right col-span-1 flex justify-end space-x-2",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>F("students",e.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-full",title:"학생 복구",children:(0,a.jsx)(n.cO3,{})}),(0,a.jsx)("button",{onClick:()=>H("students",e.id,"hard"),className:"p-2 text-red-600 hover:bg-red-100 rounded-full",title:"학생 영구 삭제",children:(0,a.jsx)(n.eHT,{})})]}):(0,a.jsx)("button",{onClick:()=>H("students",e.id,"soft"),className:"p-2 text-yellow-600 hover:bg-yellow-100 rounded-full",title:"학생 숨기기 (탈퇴)",children:(0,a.jsx)(n.IXo,{})})})]},e.id)):(0,a.jsx)("p",{className:"text-sm text-center text-gray-400 py-4",children:w?"삭제된 학생이 없습니다.":"등록된 학생이 없습니다."})})]})]})]})]})}},9730:(e,t,s)=>{"use strict";s.d(t,{A:()=>m,AuthProvider:()=>o});var a=s(5155),l=s(2115),r=s(2553),i=s(550),n=s(9708),d=s(3136);let c=(0,l.createContext)({user:null,loading:!0}),o=e=>{let{children:t}=e,[s,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{let e=(0,r.hg)(i.j,async e=>{if(e){let s={...e};try{var t;if(null==(t=e.email)?void 0:t.endsWith("@rulemakers.co.kr"))s.role="superadmin";else{let t=(0,n.rJ)(i.db,"academies"),a=(0,n.P)(t,(0,n._M)("adminEmail","==",e.email),(0,n._M)("isDeleted","==",!1)),l=await (0,n.GG)(a);if(l.empty)await i.j.signOut(),s=null;else{let e=l.docs[0];s&&(s.role="academyadmin",s.academyId=e.id,s.academyName=e.data().name)}}}catch(e){console.error("Failed to fetch user role, signing out.",e),await i.j.signOut(),s=null}o(s)}else o(null);u(!1)});return()=>e()},[]),m)?(0,a.jsx)(d.A,{}):(0,a.jsx)(c.Provider,{value:{user:s,loading:m},children:t})},m=()=>(0,l.useContext)(c)}},e=>{e.O(0,[135,965,844,240,441,255,358],()=>e(e.s=6529)),_N_E=e.O()}]);